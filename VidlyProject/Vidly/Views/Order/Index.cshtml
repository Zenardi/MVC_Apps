@model Vidly.ViewModels.OrderFormViewModel
@{
    ViewBag.Title = "Pedidos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<h2>Incluir Pedido</h2>


<form id="prodForm" method="post" class="form-horizontal">
        <div class="form-group">
            <div class="col-xs-5">
                    @Html.DropDownListFor(m => m.Customers, new SelectList(Model.Customers, "Name", "Name"), "Selecione um Cliente", new { @class = "form-control dropdown" })
            </div>
            <div class="col-xs-4 ">
                <input type="text" class="form-control" name="date" placeholder="Data da Entrega"/>
            </div>
            <div class="col-xs-4">
                <label class="h3">Pedido</label>
            </div>
        </div>

        <div title="rowForm" class="form-group">
            <div class="col-lg-3">
              @Html.DropDownListFor(m => m.Customers, new SelectList(Model.Products, "Description", "Description"), "Selecione um Cliente", new { @class = "form-control dropdown" })
            </div>
            <div class="col-lg-2">
                <input type="text" class="form-control" name="quantidade" placeholder="Quantidade" value="1" />
            </div>
            <div class="col-lg-2">
                <input type="text" class="form-control" name="valor" placeholder="Valor" value="1"/>
            </div>
            <div class="col-lg-3">
                <input type="text" class="form-control" name="subtotal" placeholder="Total" disabled="disabled" value=""/>
            </div>
            <div class="col-lg-1">
                <button type="button" class="btn btn-info addButton"><i class="glyphicon glyphicon-plus"></i></button>
            </div>
        </div>

        <!-- The template for adding new field -->
        <div class="form-group hide" id="bookTemplate" title="rowForm">
            <div class="col-lg-3">
                @Html.DropDownListFor(m => m.Customers, new SelectList(Model.Products, "Description", "Description"), "Selecione um Cliente", new { @class = "form-control dropdown" })
            </div>
            <div class="col-lg-2">
                <input type="text" class="form-control" name="quantidade" placeholder="Quantidade"/>
            </div>
            <div class="col-lg-2">
                <input type="text" class="form-control" name="valor" placeholder="Valor"/>
            </div>
            <div class="col-lg-3">
                <input type="text" class="form-control" name="subtotal" placeholder="Total" disabled="disabled"/>
            </div>
            <div class="col-lg-1">
                <button type="button" class="btn btn-danger removeButton"><i class="glyphicon glyphicon-minus"></i></button>
            </div>
        </div>

        <div class="form-group">
            <div class="col-lg-12">
                <input type="text" class="form-control" disabled="disabled" name="total" placeholder="Total"/>
            </div>
        </div>
        <div class="form-group">
            <div class="col-xs-5">
                <button type="submit" class="btn btn-info">Salvar</button>
            </div>
        </div>

    </form>

        @section scripts
{
            <script>
                
                $(document).ready(function () {
                    $('input[name="valor"]').mask('000.000.000.000.000,00', { reverse: true });
                });

                $('#prodForm').on('change', function () {
                    var $tblrows = $("#prodForm div[title='rowForm']");
                    
                    $tblrows.each(function (index) {
                        var $tblrow = $(this);
                        var a = $tblrow.children();
                        var quantidade = a.find('input[name="quantidade"]');
                        var valor = a.find('input[name="valor"]');
                        var subtotal = a.find('input[name="subtotal"]');
                        
                        subtotal.val(quantidade.val() * valor.val());
                    });
                });


                $(document).ready(function () {

                    var bookIndex = 0;
                    $('#prodForm')

                        // Add button click handler
                        .on('click', '.addButton', function () {
                            bookIndex++;
                            var $template = $('#bookTemplate'),
                                $clone = $template
                                    .clone()
                                    .removeClass('hide')
                                    .removeAttr('id')
                                    .attr('data-book-index', bookIndex)
                                    .insertBefore($template);

                            // Update the name attributes
                            $clone
                                .find('[name="produto"]').attr('name', 'produto').end()
                                .find('[name="quantidade"]').attr('name', 'quantidade').end()
                                .find('[name="valor"]').attr('name', 'valor').end()
                                .find('[name="subtotal"]').attr('name', 'subtotal').end();
                        })

                        // Remove button click handler
                        .on('click', '.removeButton', function () {
                            var $row = $(this).parents('.form-group'),
                                index = $row.attr('data-book-index');


                            // Remove element containing the fields
                            $row.remove();
                        });
                });
            </script>
        }
